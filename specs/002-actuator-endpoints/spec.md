# 功能規格: Actuator 常用端點學習擴充

**功能分支**: `002-actuator-endpoints`  
**建立日期**: 2026-01-08  
**狀態**: Draft  
**輸入**: 使用者描述: "加入常用的 Spring Actuator 端點學習項目與說明，包含健康、資訊、指標、日誌、診斷、HTTP 追蹤、組態與安全曝露控制"

## Clarifications

### Session 2026-01-08

- Q: 端點曝露範圍為何？ A: 僅開放學習清單端點（health/info/metrics/prometheus/loggers/mappings/beans/conditions/env/configprops）
- Q: env/configprops 顯示範圍？ A: 完整顯示 env/configprops 內容
- Q: 敏感值遮罩策略？ A: 不遮罩敏感值
- Q: Dump 端點範圍？ A: 僅包含 threaddump（不含 heapdump）
- Q: HTTP 追蹤內容範圍？ A: 完整保留 request/response 內容

## 使用情境與測試 *(必填)*

### 使用者故事 1 - 健康檢查與可用性理解 (Priority: P1)

學習者能理解整體健康狀態與 Readiness/Liveness 的差異，並知道依賴元件是否影響可用性。

**為何是此優先級**: 健康檢查是可觀測性的核心入口，能快速理解系統是否可用。

**獨立測試**: 僅完成此故事即可讓學習者分辨服務可用狀態與是否準備接流量。

**驗收情境**:

1. **Given** 應用已啟動，**When** 學習者查看健康檢查結果，**Then** 能清楚辨識整體可用狀態
2. **Given** 依賴元件尚未就緒，**When** 學習者查看 Readiness，**Then** 能理解尚未接流量的原因

---

### 使用者故事 2 - 應用資訊與指標監控 (Priority: P2)

學習者能看到應用資訊摘要與指標總覽，理解指標用途並查詢單一指標細節。

**為何是此優先級**: 資訊與指標是運維觀測的主要入口，能對應版本與系統狀態。

**獨立測試**: 完成此故事即可展示資訊摘要與指標查詢的學習價值。

**驗收情境**:

1. **Given** 應用已啟動，**When** 學習者查看應用資訊，**Then** 能看到版本、環境與建置資訊
2. **Given** 應用已運行一段時間，**When** 學習者查看指標，**Then** 能查到至少一項指標的細節

---

### 使用者故事 3 - 診斷、日誌與組態檢視 (Priority: P3)

學習者能進行診斷觀測、調整日誌層級，並檢視組態與路由映射。

**為何是此優先級**: 這些功能是排查問題時最常使用的輔助工具。

**獨立測試**: 完成此故事即可展示除錯流程與組態檢視的價值。

**驗收情境**:

1. **Given** 學習者需要除錯，**When** 調整日誌層級後再查看輸出，**Then** 能看到更詳細的除錯資訊
2. **Given** 學習者檢視組態與路由，**When** 查詢對應資訊，**Then** 能確認實際載入的設定與路由映射

---

### 邊界情況

- 當某些端點因曝露設定被關閉時，系統如何明確提示？
- 當診斷資料量過大時，系統如何避免造成理解困難？
- 當環境變數含敏感資訊時，系統如何避免誤曝露？

## 需求 *(必填)*

### 功能性需求

- **FR-001**: 系統 MUST 提供整體健康狀態檢視，並能區分 Readiness 與 Liveness
- **FR-002**: 系統 MUST 讓學習者理解依賴元件是否影響可用性
- **FR-003**: 系統 MUST 提供應用資訊摘要 (版本、環境、建置資訊)
- **FR-004**: 系統 MUST 提供指標總覽與單一指標細節查詢
- **FR-005**: 系統 MUST 提供可供監控系統抓取的指標格式
- **FR-006**: 系統 MUST 允許學習者調整日誌層級並可回復
- **FR-007**: 系統 MUST 提供診斷資訊檢視 (如執行緒、記憶體、條件判斷、Bean 列表)
- **FR-008**: 系統 MUST 提供 HTTP 請求觀測的方式以協助除錯
- **FR-009**: 系統 MUST 提供組態與環境資訊檢視，並說明來源
- **FR-010**: 系統 MUST 提供端點曝露控制的說明與範例
- **FR-011**: 系統 MUST 僅曝露學習清單端點以降低誤曝露風險
- **FR-012**: 系統 MUST 完整顯示 env/configprops 內容以利學習
- **FR-013**: 系統 MUST 不遮罩敏感值以完整呈現設定內容
- **FR-014**: 系統 MUST 僅提供 threaddump，不提供 heapdump
- **FR-015**: 系統 MUST 完整保留 HTTP 追蹤的 request/response 內容

## 假設

- 專案以學習與示範為主，不含正式營運需求
- 端點僅供本機或受控環境測試
- 不依賴外部服務或第三方系統
- 端點曝露範圍採學習清單
- env/configprops 允許完整顯示
- 不遮罩敏感值
- 不提供 heapdump
- HTTP 追蹤保留完整內容

## 成功標準 *(必填)*

### 可衡量成果

- **SC-001**: 80% 以上的學習者可在 45 分鐘內完成三個使用者故事
- **SC-002**: 90% 的學習者可清楚描述 Readiness 與 Liveness 的差異
- **SC-003**: 90% 的學習者可查詢至少一項指標並說明用途
- **SC-004**: 80% 的學習者可完成一次日誌層級調整並復原
